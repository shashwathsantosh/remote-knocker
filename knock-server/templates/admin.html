<!DOCTYPE html>
<html>
<head>
    <title>Knocker Admin</title>
    <meta http-equiv="refresh" content="2"> <!-- Auto Refresh -->
    <style>
        body { font-family: monospace; background: #1e1e1e; color: #d4d4d4; padding: 20px; }
        h2 { border-bottom: 1px solid #444; padding-bottom: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: #252526; padding: 15px; border-radius: 8px; border: 1px solid #333; }
        .online { border-left: 5px solid #4CAF50; }
        .offline { border-left: 5px solid #f44336; opacity: 0.7; }
        table { width: 100%; border-collapse: collapse; background: #252526; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #333; }
        th { background: #333; }
        .btn-test { background: #007acc; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px;}
        .btn-test:hover { background: #005f9e; }
    </style>
</head>
<body>
    <h2>ðŸ“¡ Device Fleet</h2>
    <div class="grid">
        <!-- Loop through devices sent from Python -->
        {% for mac, dev in devices.items() %}
        <div class="card {{ 'online' if dev.is_online else 'offline' }}">
            <h3>{{ mac }}</h3>
            <p>Status: <b style="color: {{ '#4CAF50' if dev.is_online else '#f44336' }}">{{ 'ONLINE' if dev.is_online else 'OFFLINE' }}</b></p>
            <p>Last Seen: {{ dev.seconds_ago }}s ago</p>
            <p>Knocks Delivered: {{ dev.knocks }}</p>
            {% if dev.is_online %}
                <button class="btn-test" onclick="fetch('/api/queue-knock?target={{ mac }}', {method:'POST'})">FORCE TEST</button>
            {% endif %}
        </div>
        {% else %}
        <p style="color: #666">No devices have connected yet.</p>
        {% endfor %}
    </div>

    <h2>ðŸ“œ System Logs</h2>
    <table>
        <tr><th>Time / Event</th></tr>
        {% for log in logs %}
        <tr><td>{{ log }}</td></tr>
        {% endfor %}
    </table>
</body>
</html>